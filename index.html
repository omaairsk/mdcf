<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Pharmacy | Financial Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --glass: rgba(15, 23, 42, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow-x: hidden;
            background-color: #020617;
            color: #f8fafc;
            margin: 0;
            padding: 0;
            width: 100vw;
            min-height: 100vh;
        }

        #canvas-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -1; 
            pointer-events: none;
        }

        .glass-card { 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            border: 1px solid var(--border); 
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            border-color: rgba(56, 189, 248, 0.3);
            transform: translateY(-4px);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .center-layout {
            width: 100%;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; color: black; }
            .glass-card { border: 1px solid #ddd; background: white; color: black; box-shadow: none; }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(56, 189, 248, 0.1);
            border-left-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, deleteDoc, onSnapshot, query, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        try {
            const firebaseConfig = JSON.parse(__firebase_config);
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            window.firebaseApp = { 
                auth, db, appId, collection, doc, addDoc, deleteDoc, onSnapshot, query, 
                writeBatch, getDocs, signInWithCustomToken, signInAnonymously, onAuthStateChanged 
            };
            
            // Dispatch event to notify React that Firebase is ready
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (e) {
            console.error("Firebase init failed:", e);
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Enhanced 3D Background ---
        const ThreeBackground = () => {
            const containerRef = useRef();

            useEffect(() => {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                containerRef.current.appendChild(renderer.domElement);

                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(ambientLight);
                const pointLight = new THREE.PointLight(0x38bdf8, 2);
                pointLight.position.set(20, 20, 20);
                scene.add(pointLight);

                const group = new THREE.Group();
                const geometry = new THREE.SphereGeometry(0.4, 16, 16);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x0ea5e9, 
                    shininess: 100,
                    transparent: true,
                    opacity: 0.6
                });

                for (let i = 0; i < 60; i++) {
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(
                        (Math.random() - 0.5) * 60,
                        (Math.random() - 0.5) * 60,
                        (Math.random() - 0.5) * 40
                    );
                    mesh.scale.setScalar(Math.random() * 2 + 0.5);
                    group.add(mesh);
                }
                scene.add(group);

                const starGeo = new THREE.BufferGeometry();
                const starPos = new Float32Array(3000);
                for(let i=0; i<3000; i++) starPos[i] = (Math.random() - 0.5) * 200;
                starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
                const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
                const stars = new THREE.Points(starGeo, starMat);
                scene.add(stars);

                camera.position.z = 30;

                let mouseX = 0, mouseY = 0;
                const onMouseMove = (e) => {
                    mouseX = (e.clientX - window.innerWidth / 2) * 0.02;
                    mouseY = (e.clientY - window.innerHeight / 2) * 0.02;
                };

                const animate = () => {
                    requestAnimationFrame(animate);
                    group.rotation.y += 0.002;
                    group.rotation.x += 0.001;
                    stars.rotation.y -= 0.0005;

                    camera.position.x += (mouseX - camera.position.x) * 0.05;
                    camera.position.y += (-mouseY - camera.position.y) * 0.05;
                    camera.lookAt(scene.position);

                    renderer.render(scene, camera);
                };
                animate();

                window.addEventListener('mousemove', onMouseMove);
                const handleResize = () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('resize', handleResize);
                    if (containerRef.current) containerRef.current.innerHTML = "";
                };
            }, []);

            return <div ref={containerRef} id="canvas-container" />;
        };

        // --- Main App Component ---
        const App = () => {
            const [fbReady, setFbReady] = useState(!!window.firebaseApp);
            const [user, setUser] = useState(null);
            const [role, setRole] = useState('staff'); 
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [records, setRecords] = useState([]);
            const [loadingData, setLoadingData] = useState(true);

            // Access keys as requested
            const [staffPass, setStaffPass] = useState('mdc@123');
            const [adminPass, setAdminPass] = useState('Fadmin');

            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                sales: '', expense: '', refund: '', dues: '', bankDeposit: ''
            });

            // (1) Listen for Firebase Initialization
            useEffect(() => {
                const handleReady = () => setFbReady(true);
                window.addEventListener('firebase-ready', handleReady);
                return () => window.removeEventListener('firebase-ready', handleReady);
            }, []);

            // (2) Auth Initialization
            useEffect(() => {
                if (!fbReady) return;
                const { auth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } = window.firebaseApp;

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (err) {
                        console.error("Auth init failed:", err);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, [fbReady]);

            // (3) Data Fetching from Cloud
            useEffect(() => {
                if (!fbReady || !user) return;
                const { db, appId, collection, onSnapshot } = window.firebaseApp;

                const recordsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'pharmacy_records');
                const unsubscribe = onSnapshot(recordsCollection, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => b.date.localeCompare(a.date));
                    setRecords(data);
                    setLoadingData(false);
                }, (error) => {
                    console.error("Firestore error:", error);
                });

                return () => unsubscribe();
            }, [fbReady, user]);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [records, isLoggedIn, activeTab, fbReady]);

            const stats = useMemo(() => {
                const totalSales = records.reduce((acc, r) => acc + (Number(r.sales) || 0), 0);
                const totalExpense = records.reduce((acc, r) => acc + (Number(r.expense) || 0), 0);
                const totalRefund = records.reduce((acc, r) => acc + (Number(r.refund) || 0), 0);
                return { totalSales, totalExpense, totalRefund, netProfit: totalSales - totalExpense - totalRefund };
            }, [records]);

            const monthlySummary = useMemo(() => {
                const groups = {};
                records.forEach(r => {
                    const month = r.date.substring(0, 7);
                    if (!groups[month]) groups[month] = { month, sales: 0, expenses: 0, profit: 0 };
                    groups[month].sales += (Number(r.sales) || 0);
                    groups[month].expenses += (Number(r.expense) || 0);
                    groups[month].profit += ((Number(r.sales) || 0) - (Number(r.expense) || 0) - (Number(r.refund) || 0));
                });
                return Object.values(groups).sort((a, b) => b.month.localeCompare(a.month));
            }, [records]);

            const addRecord = async (e) => {
                e.preventDefault();
                if (!fbReady || !user) return;
                const { db, appId, collection, addDoc } = window.firebaseApp;
                
                const dayPL = Number(formData.sales) - Number(formData.expense) - Number(formData.refund);
                const cashHand = Number(formData.sales) - Number(formData.bankDeposit) - Number(formData.dues) - Number(formData.refund);
                
                const newRecord = { 
                    ...formData, 
                    dayPL, 
                    cashHand,
                    createdAt: Date.now()
                };

                try {
                    const recordsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'pharmacy_records');
                    await addDoc(recordsCollection, newRecord);
                    setFormData({ date: new Date().toISOString().split('T')[0], sales: '', expense: '', refund: '', dues: '', bankDeposit: '' });
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            };

            const handleDelete = async (id) => {
                if (role !== 'admin' || !fbReady) return;
                if (!confirm('Are you sure you want to delete this log?')) return;
                const { db, appId, doc, deleteDoc } = window.firebaseApp;
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'pharmacy_records', id);
                    await deleteDoc(docRef);
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            };

            const clearAllData = async () => {
                if (role !== 'admin' || !fbReady) return;
                if (!confirm('WARNING: This will permanently delete ALL cloud data. Continue?')) return;
                const { db, appId, collection, doc, deleteDoc, writeBatch, getDocs } = window.firebaseApp;
                
                try {
                    const recordsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'pharmacy_records');
                    const snapshot = await getDocs(recordsCollection);
                    const batch = writeBatch(db);
                    snapshot.docs.forEach((d) => {
                        batch.delete(doc(db, 'artifacts', appId, 'public', 'data', 'pharmacy_records', d.id));
                    });
                    await batch.commit();
                } catch (e) {
                    console.error("Error clearing data: ", e);
                }
            };

            const handleLogin = (selectedRole, pass) => {
                if (selectedRole === 'admin' && pass === adminPass) {
                    setRole('admin');
                    setIsLoggedIn(true);
                } else if (selectedRole === 'staff' && pass === staffPass) {
                    setRole('staff');
                    setIsLoggedIn(true);
                } else {
                    alert("Authentication Failed");
                }
            };

            if (!fbReady) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-slate-950">
                        <div className="spinner mb-6"></div>
                        <h1 className="text-sky-400 font-bold tracking-widest uppercase text-sm animate-pulse">Initializing System...</h1>
                    </div>
                );
            }

            if (!isLoggedIn) {
                return (
                    <div className="flex items-center justify-center min-h-screen p-6 w-full">
                        <ThreeBackground />
                        <div className="glass-card p-10 w-full max-w-md space-y-8 animate-in fade-in zoom-in duration-500">
                            <div className="text-center">
                                <div className="inline-block p-4 bg-sky-500/20 rounded-2xl mb-4 border border-sky-500/30">
                                    <i data-lucide="shield-check" className="w-10 h-10 text-sky-400"></i>
                                </div>
                                <h1 className="text-4xl font-black tracking-tighter text-white uppercase">MEDICAL <span className="text-sky-500">PHARMACY</span></h1>
                                <p className="text-slate-400 text-xs mt-2 font-bold tracking-widest uppercase opacity-60">Pharmacy Management Terminal</p>
                            </div>
                            <div className="space-y-6">
                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => setRole('staff')} className={`flex items-center justify-center gap-2 py-3 rounded-xl border transition-all ${role === 'staff' ? 'bg-sky-500/20 border-sky-500 text-sky-400' : 'border-slate-800 text-slate-500'}`}>
                                        <i data-lucide="users" className="w-4 h-4"></i> Staff
                                    </button>
                                    <button onClick={() => setRole('admin')} className={`flex items-center justify-center gap-2 py-3 rounded-xl border transition-all ${role === 'admin' ? 'bg-indigo-500/20 border-indigo-500 text-indigo-400' : 'border-slate-800 text-slate-500'}`}>
                                        <i data-lucide="key" className="w-4 h-4"></i> Admin
                                    </button>
                                </div>
                                <input 
                                    type="password" 
                                    id="passInput"
                                    className="w-full bg-slate-950/80 border border-slate-800 rounded-xl p-4 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/40 text-center tracking-widest"
                                    placeholder="Enter Access Key"
                                    onKeyDown={(e) => e.key === 'Enter' && handleLogin(role, e.target.value)}
                                />
                                <button 
                                    onClick={() => handleLogin(role, document.getElementById('passInput').value)}
                                    className="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all flex items-center justify-center gap-3"
                                >
                                    Log In <i data-lucide="chevron-right" className="w-4 h-4"></i>
                                </button>
                            </div>
                            <div className="text-center">
                                <p className="text-[10px] text-slate-600 uppercase tracking-widest font-bold">Cloud Sync Enabled</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20">
                    <ThreeBackground />
                    
                    <div className="center-layout pt-6 px-4 sm:px-6">
                        <nav className="no-print glass-card p-4 flex flex-wrap items-center justify-between gap-6 shadow-2xl sticky top-6 z-50">
                            <div className="flex items-center gap-4">
                                <div className={`p-3 rounded-2xl ${role === 'admin' ? 'bg-indigo-600' : 'bg-emerald-600'}`}>
                                    <i data-lucide="activity" className="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h2 className="font-extrabold text-xl tracking-tighter uppercase">MEDICAL PHARMACY</h2>
                                    <p className="text-[10px] uppercase font-black text-slate-500 tracking-widest">{role} Panel • Cloud Active</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-2 bg-white/5 p-1 rounded-2xl border border-white/5">
                                {['dashboard', 'logs', 'admin'].map(tab => (
                                    (tab !== 'admin' || role === 'admin') && (
                                        <button 
                                            key={tab}
                                            onClick={() => setActiveTab(tab)} 
                                            className={`px-6 py-2 rounded-xl text-xs font-bold uppercase transition-all ${activeTab === tab ? 'bg-white/10 text-white shadow-sm' : 'text-slate-500 hover:text-slate-300'}`}
                                        >
                                            {tab}
                                        </button>
                                    )
                                ))}
                                <button onClick={() => setIsLoggedIn(false)} className="px-4 py-2 text-rose-500 hover:bg-rose-500/10 rounded-xl">
                                    <i data-lucide="power" className="w-4 h-4"></i>
                                </button>
                            </div>
                        </nav>
                    </div>

                    <main className="center-layout px-4 sm:px-6 mt-10">
                        {loadingData ? (
                            <div className="flex flex-col items-center justify-center py-20 text-sky-400">
                                <div className="spinner mb-4"></div>
                                <p className="font-bold tracking-widest uppercase text-xs">Synchronizing Data...</p>
                            </div>
                        ) : activeTab === 'dashboard' ? (
                            <div className="space-y-10 animate-in fade-in slide-in-from-bottom duration-700">
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {[
                                        { label: 'Sales', val: stats.totalSales, col: 'border-emerald-500', icon: 'trending-up' },
                                        { label: 'Expense', val: stats.totalExpense, col: 'border-rose-500', icon: 'trending-down' },
                                        { label: 'Refund', val: stats.totalRefund, col: 'border-amber-500', icon: 'refresh-cw' },
                                        { label: 'Profit', val: stats.netProfit, col: 'border-sky-500', icon: 'wallet' }
                                    ].map((s, idx) => (
                                        <div key={idx} className={`glass-card p-6 border-l-4 ${s.col}`}>
                                            <p className="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-1">{s.label}</p>
                                            <div className="flex items-end justify-between">
                                                <h3 className="text-2xl font-black">₹{s.val.toLocaleString()}</h3>
                                                <i data-lucide={s.icon} className="w-4 h-4 opacity-30"></i>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="grid grid-cols-1 xl:grid-cols-12 gap-10 items-start">
                                    <div className="xl:col-span-4 no-print glass-card p-8 border-t-4 border-sky-500 shadow-xl">
                                        <h4 className="text-xl font-black tracking-tight flex items-center gap-3 mb-8">
                                            <i data-lucide="plus-square" className="text-sky-400"></i> New Record
                                        </h4>
                                        <form onSubmit={addRecord} className="space-y-4">
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 block">Date</label>
                                                <input type="date" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} className="w-full bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm focus:border-sky-500 outline-none" required />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <input type="number" placeholder="Sales" value={formData.sales} onChange={e => setFormData({...formData, sales: e.target.value})} className="bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm outline-none" />
                                                <input type="number" placeholder="Expense" value={formData.expense} onChange={e => setFormData({...formData, expense: e.target.value})} className="bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm outline-none" />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <input type="number" placeholder="Refund" value={formData.refund} onChange={e => setFormData({...formData, refund: e.target.value})} className="bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm outline-none" />
                                                <input type="number" placeholder="Dues" value={formData.dues} onChange={e => setFormData({...formData, dues: e.target.value})} className="bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm outline-none" />
                                            </div>
                                            <input type="number" placeholder="Bank Deposit" value={formData.bankDeposit} onChange={e => setFormData({...formData, bankDeposit: e.target.value})} className="w-full bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm outline-none" />
                                            <button type="submit" className="w-full bg-sky-600 hover:bg-sky-500 py-4 rounded-xl font-black text-xs uppercase tracking-widest transition-all mt-4">Save Entry</button>
                                        </form>
                                    </div>

                                    <div className="xl:col-span-8 glass-card p-8 border-t-4 border-indigo-500 shadow-xl overflow-hidden">
                                        <div className="flex justify-between items-center mb-8">
                                            <h4 className="text-xl font-black tracking-tight">Monthly Performance</h4>
                                            <div className="flex gap-2">
                                                <button onClick={() => window.print()} className="p-2 bg-white/5 rounded-lg hover:bg-white/10"><i data-lucide="printer" className="w-4 h-4"></i></button>
                                            </div>
                                        </div>
                                        <div className="overflow-x-auto custom-scrollbar">
                                            <table className="w-full text-left">
                                                <thead className="text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-slate-800">
                                                    <tr>
                                                        <th className="pb-4">Fiscal Period</th>
                                                        <th className="pb-4 text-right">Sales</th>
                                                        <th className="pb-4 text-right">Expense</th>
                                                        <th className="pb-4 text-right">Net Profit</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-800/40">
                                                    {monthlySummary.map(m => (
                                                        <tr key={m.month} className="group hover:bg-white/5 transition-all">
                                                            <td className="py-5 font-bold">{m.month}</td>
                                                            <td className="py-5 text-right text-emerald-400 font-semibold">₹{m.sales.toLocaleString()}</td>
                                                            <td className="py-5 text-right text-rose-400 font-semibold">₹{m.expenses.toLocaleString()}</td>
                                                            <td className={`py-5 text-right font-black ${m.profit >= 0 ? 'text-sky-400' : 'text-rose-500'}`}>₹{m.profit.toLocaleString()}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : activeTab === 'logs' ? (
                            <div className="glass-card overflow-hidden shadow-2xl border-t-4 border-emerald-500 animate-in slide-in-from-bottom duration-700">
                                <div className="p-8 border-b border-slate-800 flex justify-between items-center">
                                    <h4 className="text-2xl font-black tracking-tighter">Transaction Ledger</h4>
                                    <i data-lucide="database" className="w-5 h-5 text-emerald-500"></i>
                                </div>
                                <div className="overflow-x-auto custom-scrollbar">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-900/40 text-slate-500 text-[10px] font-black uppercase tracking-widest">
                                            <tr>
                                                <th className="p-5 pl-8">Date</th>
                                                <th className="p-5 text-right">Sales</th>
                                                <th className="p-5 text-right">Expense</th>
                                                <th className="p-5 text-right">Banked</th>
                                                <th className="p-5 text-right">Cash</th>
                                                <th className="p-5 text-right">P/L</th>
                                                <th className="p-5 text-center pr-8">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-800/40">
                                            {records.map(r => (
                                                <tr key={r.id} className="hover:bg-white/5 transition-all">
                                                    <td className="p-5 pl-8 font-bold">{r.date}</td>
                                                    <td className="p-5 text-right font-semibold">₹{Number(r.sales).toLocaleString()}</td>
                                                    <td className="p-5 text-right text-rose-400">₹{Number(r.expense).toLocaleString()}</td>
                                                    <td className="p-5 text-right text-sky-400">₹{Number(r.bankDeposit).toLocaleString()}</td>
                                                    <td className="p-5 text-right font-black">₹{Number(r.cashHand).toLocaleString()}</td>
                                                    <td className={`p-5 text-right font-black ${r.dayPL >= 0 ? 'text-emerald-400' : 'text-rose-500'}`}>₹{r.dayPL.toLocaleString()}</td>
                                                    <td className="p-5 text-center pr-8">
                                                        {role === 'admin' && (
                                                            <button onClick={() => handleDelete(r.id)} className="text-slate-600 hover:text-rose-500 transition-all">
                                                                <i data-lucide="trash-2" className="w-4 h-4"></i>
                                                            </button>
                                                        )}
                                                    </td>
                                                </tr>
                                            ))}
                                            {records.length === 0 && (
                                                <tr><td colSpan="7" className="p-10 text-center text-slate-600 font-bold uppercase tracking-widest text-xs">No logs found in cloud storage</td></tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ) : activeTab === 'admin' && role === 'admin' ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-10 animate-in zoom-in duration-500">
                                <div className="glass-card p-10 space-y-8 border-t-4 border-indigo-600 shadow-xl">
                                    <h3 className="text-2xl font-black flex items-center gap-3"><i data-lucide="shield" className="text-indigo-400"></i> Keys</h3>
                                    <div className="space-y-4">
                                        <p className="text-xs text-slate-500">Local terminal security keys.</p>
                                        <input type="text" value={staffPass} onChange={e => setStaffPass(e.target.value)} className="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 font-mono text-indigo-400 focus:outline-none" placeholder="Staff Pass" />
                                        <input type="text" value={adminPass} onChange={e => setAdminPass(e.target.value)} className="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 font-mono text-rose-400 focus:outline-none" placeholder="Admin Pass" />
                                        <button onClick={() => alert('Updated!')} className="w-full bg-indigo-600 py-4 rounded-xl font-black uppercase tracking-widest">Update Local Terminal Keys</button>
                                    </div>
                                </div>
                                <div className="glass-card p-10 space-y-8 border-t-4 border-rose-600 shadow-xl">
                                    <h3 className="text-2xl font-black flex items-center gap-3"><i data-lucide="database-zap" className="text-rose-400"></i> Cloud Maintenance</h3>
                                    <div className="space-y-4">
                                        <p className="text-xs text-rose-500 font-bold">DANGER ZONE: Operations below affect all devices.</p>
                                        <button onClick={clearAllData} className="w-full border-2 border-rose-500/30 text-rose-500 hover:bg-rose-500/10 py-4 rounded-xl font-black uppercase tracking-widest transition-all">Purge Cloud Database</button>
                                    </div>
                                </div>
                            </div>
                        ) : null}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        window.onload = () => { if (window.lucide) window.lucide.createIcons(); };
    </script>
</body>
</html>
